{"version":3,"file":"fsms-angular-pubsub.js","sources":["../../../projects/fsms-angular-pubsub/src/lib/pubsub.service.ts","../../../projects/fsms-angular-pubsub/src/lib/pubsub.module.ts","../../../projects/fsms-angular-pubsub/src/lib/subscribe-options.ts","../../../projects/fsms-angular-pubsub/src/lib/message.ts","../../../projects/fsms-angular-pubsub/src/public-api.ts","../../../projects/fsms-angular-pubsub/src/fsms-angular-pubsub.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { ReplaySubject, Subscription } from 'rxjs';\r\nimport { Message } from './message';\r\nimport { SubscribeOptions } from './subscribe-options';\r\n\r\nconst ServiceName: string = 'PubSub Service';\r\n@Injectable()\r\nexport class PubSubService {\r\n  private map = new Map();\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  public subscribe({\r\n    message,\r\n    callback,\r\n    error,\r\n    complete,\r\n  }: SubscribeOptions): Subscription {\r\n    if (!message) {\r\n      throw new Error(\r\n        `[${ServiceName}] => Subscription method must get event name.`\r\n      );\r\n    }\r\n\r\n    const messageType = message.type;\r\n\r\n    if (!this.hasSubject(messageType)) {\r\n      this.setNewSubject(messageType);\r\n    }\r\n\r\n    let subject = this.getSubject(messageType);\r\n\r\n    if (typeof callback !== 'function') {\r\n      return subject.asObservable();\r\n    } else {\r\n      const subscription = subject\r\n        .asObservable()\r\n        .subscribe(callback, error, complete);\r\n\r\n      this.addSubscription(subscription);\r\n\r\n      return subscription;\r\n    }\r\n  }\r\n\r\n  public publish(message: Message) {\r\n    if (!message) {\r\n      throw new Error(\r\n        `[${ServiceName}] => Publish method must get event name.`\r\n      );\r\n    } else if (!this.hasSubject(message.type)) {\r\n      return;\r\n    }\r\n\r\n    this.getSubject(message.type).next(message);\r\n  }\r\n\r\n  clearAllSubscriptions() {\r\n    this.subscriptions.forEach((s) => s && s.unsubscribe());\r\n    this.subscriptions.length = 0;\r\n    this.map.clear();\r\n  }\r\n\r\n  private addSubscription(sub: Subscription) {\r\n    this.subscriptions.push(sub);\r\n  }\r\n\r\n  private getSubject(messageType: string) {\r\n    return this.map.get(messageType);\r\n  }\r\n\r\n  private hasSubject(messageType: string) {\r\n    return this.map.has(messageType);\r\n  }\r\n\r\n  private setNewSubject(messageType: string) {\r\n    this.map.set(messageType, new ReplaySubject<any>());\r\n  }\r\n}\r\n","\r\nimport { ModuleWithProviders, NgModule } from '@angular/core';\r\nimport { PubSubService } from './pubsub.service';\r\n\r\n@NgModule()\r\nexport class PubSubModule {\r\n  public static forRoot(): ModuleWithProviders<PubSubModule> {\r\n    return {\r\n      ngModule: PubSubModule,\r\n      providers: [\r\n        PubSubService\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { Message } from './message';\r\n\r\nexport class SubscribeOptions {\r\n  message: Message;\r\n  callback?: (value: any) => void;\r\n  error?: (error: any) => void;\r\n  complete?: () => void;\r\n}\r\n","export class Message {\r\n  type: string;\r\n}\r\n","/*\r\n * Public API Surface of fsms-angular-pubsub\r\n */\r\n\r\nexport * from './lib/pubsub.service';\r\nexport * from './lib/pubsub.module';\r\nexport * from './lib/subscribe-options';\r\nexport * from './lib/message';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;AAKA,MAAM,WAAW,GAAW,gBAAgB,CAAC;MAEhC,aAAa;IAD1B;QAEU,QAAG,GAAG,IAAI,GAAG,EAAE,CAAC;QAChB,kBAAa,GAAmB,EAAE,CAAC;KAoE5C;IAlEQ,SAAS,CAAC,EACf,OAAO,EACP,QAAQ,EACR,KAAK,EACL,QAAQ,GACS;QACjB,IAAI,CAAC,OAAO,EAAE;YACZ,MAAM,IAAI,KAAK,CACb,IAAI,WAAW,+CAA+C,CAC/D,CAAC;SACH;QAED,MAAM,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC;QAEjC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE;YACjC,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;SACjC;QAED,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QAE3C,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;YAClC,OAAO,OAAO,CAAC,YAAY,EAAE,CAAC;SAC/B;aAAM;YACL,MAAM,YAAY,GAAG,OAAO;iBACzB,YAAY,EAAE;iBACd,SAAS,CAAC,QAAQ,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;YAExC,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;YAEnC,OAAO,YAAY,CAAC;SACrB;KACF;IAEM,OAAO,CAAC,OAAgB;QAC7B,IAAI,CAAC,OAAO,EAAE;YACZ,MAAM,IAAI,KAAK,CACb,IAAI,WAAW,0CAA0C,CAC1D,CAAC;SACH;aAAM,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACzC,OAAO;SACR;QAED,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KAC7C;IAED,qBAAqB;QACnB,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC;QACxD,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC;QAC9B,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;KAClB;IAEO,eAAe,CAAC,GAAiB;QACvC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KAC9B;IAEO,UAAU,CAAC,WAAmB;QACpC,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;KAClC;IAEO,UAAU,CAAC,WAAmB;QACpC,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;KAClC;IAEO,aAAa,CAAC,WAAmB;QACvC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,aAAa,EAAO,CAAC,CAAC;KACrD;;;YAtEF,UAAU;;;MCDE,YAAY;IAChB,OAAO,OAAO;QACnB,OAAO;YACL,QAAQ,EAAE,YAAY;YACtB,SAAS,EAAE;gBACT,aAAa;aACd;SACF,CAAC;KACH;;;YATF,QAAQ;;;MCFI,gBAAgB;;;MCFhB,OAAO;;;ACApB;;;;ACAA;;;;;;"}